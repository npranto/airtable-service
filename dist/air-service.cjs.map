{"version":3,"file":"air-service.cjs","sources":["../index.js"],"sourcesContent":["/**\n * @module AirtableService\n * @description Provides functions to interact with Airtable API.\n */\n\nimport axios from \"axios\";\nimport pkgJSON from \"./package.json\";\n\n/**\n * Validates data using a provided validator function.\n *\n * @param {Object} data - The data to validate.\n * @param {Function} validator - The validator function to use.\n * @returns {Object} An object with `isValid` and `error` properties.\n * @throws {Error} If `validator` function does not return an object with `isValid` and `error` properties.\n */\nconst validateData = (data, validator) => {\n  if (!validator || typeof validator !== \"function\") {\n    return {\n      isValid: true,\n      error: null,\n    };\n  }\n\n  const validatorOutput = validator(data) || {};\n  const validatorOutputKeys = Object.keys(validatorOutput);\n  if (\n    !validatorOutputKeys ||\n    !validatorOutputKeys.length ||\n    !validatorOutputKeys.includes(\"isValid\") ||\n    !validatorOutputKeys.includes(\"error\")\n  ) {\n    throw new Error(\n      \"`validator` function must return an object with `isValid` and `error` properties\"\n    );\n  }\n\n  return {\n    isValid: validatorOutput.isValid,\n    error: validatorOutput.error,\n  };\n};\n\n/**\n * Logs the current version of the Airtable service.\n * @function\n */\nfunction airServiceLog() {\n  console.log(`Airtable Service - v${pkgJSON.version}`);\n}\n\n/**\n * Retrieves all records from a specific table in Airtable\n * @async\n * @param {Object} config - Configuration object with Airtable credentials\n * @param {string} config.AIRTABLE_BASE_ID - Airtable Base ID\n * @param {string} config.AIRTABLE_TABLE_NAME - Name of the Airtable table to retrieve records from\n * @param {string} config.AIRTABLE_API_KEY - Airtable API Key\n * @returns {Promise<Array>} - Promise that resolves to an array of records\n * @throws {Error} - Throws an error if unable to retrieve records from Airtable\n */\nasync function getAllRecords(config) {\n  const url = `https://api.airtable.com/v0/${config.AIRTABLE_BASE_ID}/${config.AIRTABLE_TABLE_NAME}`;\n  console.log(\"url: \", url);\n  const response = await axios.get(url, {\n    headers: {\n      Authorization: `Bearer ${config.AIRTABLE_API_KEY}`,\n    },\n  });\n  if (response.status === 200) {\n    return response.data.records;\n  } else {\n    throw new Error(\"Unable to get records from Airtable\");\n  }\n}\n\n/**\n * Retrieves a specific record from an Airtable table by its ID\n * @async\n * @param {string} recordId - ID of the record to retrieve\n * @param {Object} config - Configuration object with Airtable credentials\n * @param {string} config.AIRTABLE_BASE_ID - Airtable Base ID\n * @param {string} config.AIRTABLE_TABLE_NAME - Name of the Airtable table to retrieve the record from\n * @param {string} config.AIRTABLE_API_KEY - Airtable API Key\n * @returns {Promise<Object|null>} - Promise that resolves to the retrieved record or null if not found\n * @throws {Error} - Throws an error if unable to retrieve the record from Airtable\n */\nasync function getRecordById(recordId, config) {\n  const url = `https://api.airtable.com/v0/${config.AIRTABLE_BASE_ID}/${config.AIRTABLE_TABLE_NAME}/${recordId}`;\n  console.log(\"url: \", url);\n  try {\n    const response = await axios.get(url, {\n      headers: {\n        Authorization: `Bearer ${config.AIRTABLE_API_KEY}`,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    if (error.response.status === 404) {\n      return null;\n    } else {\n      throw new Error(\"Unable to get record from Airtable\");\n    }\n  }\n}\n\n/**\n * Creates a new record in Airtable.\n * @async\n * @param {Object|Array} data - The data to be added to the Airtable. It can be either an object or an array of objects.\n * @param {Function} validator - The validation function to be applied on the data. It should return an object with 'isValid' and 'error' properties.\n * @param {Object} config - Configuration object with Airtable credentials.\n * @param {string} config.AIRTABLE_BASE_ID - Airtable Base ID.\n * @param {string} config.AIRTABLE_TABLE_NAME - Name of the Airtable table to create record(s) in.\n * @param {string} config.AIRTABLE_API_KEY - Airtable API Key.\n * @throws {Error} Will throw an error if unable to create record(s) in Airtable.\n * @returns {Object} Returns the data of the created record(s).\n */\nasync function createRecord(data, validator, config) {\n  const url = `https://api.airtable.com/v0/${config.AIRTABLE_BASE_ID}/${config.AIRTABLE_TABLE_NAME}`;\n\n  const { isValid, error } = validateData(data, validator);\n\n  if (!isValid) {\n    throw new Error(error || \"Please pass in valid data to create a record\");\n  }\n\n  try {\n    const response = await axios.post(\n      url,\n      {\n        records: Array.isArray(data) ? [...data] : [data],\n      },\n      {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${config.AIRTABLE_API_KEY}`,\n        },\n      }\n    );\n    return response.data;\n  } catch (error) {\n    console.log(error);\n    throw new Error(\"Unable to create record in Airtable\");\n  }\n}\n\n/**\n * Updates a record in an Airtable table with the specified ID and data\n * @async\n * @param {string} recordId - ID of the record to update\n * @param {Object} data - New data for the record to be updated\n * @param {Function} validator - The validation function to be applied on the data. It should return an object with 'isValid' and 'error' properties.\n * @param {Object} config - Configuration object with Airtable credentials\n * @param {string} config.AIRTABLE_BASE_ID - Airtable Base ID\n * @param {string} config.AIRTABLE_TABLE_NAME - Name of the Airtable table to update the record in\n * @param {string} config.AIRTABLE_API_KEY - Airtable API Key\n * @returns {Promise<Object|null>} - Promise that resolves to the updated record or null if not found\n * @throws {Error} - Throws an error if unable to update the record in Airtable\n */\nasync function updateRecord(recordId, data, validator, config) {\n  const url = `https://api.airtable.com/v0/${config.AIRTABLE_BASE_ID}/${config.AIRTABLE_TABLE_NAME}/${recordId}`;\n  console.log(\"url: \", url);\n\n  const { isValid, error } = validateData(data, validator);\n\n  if (!isValid) {\n    throw new Error(error || \"Please pass in valid data to create a record\");\n  }\n\n  try {\n    const response = await axios.patch(url, data, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${config.AIRTABLE_API_KEY}`,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    if (error.response.status === 404) {\n      return null;\n    } else {\n      throw new Error(\"Unable to update record in Airtable\");\n    }\n  }\n}\n\n/**\n * Deletes a record from an Airtable table with the specified ID\n * @async\n * @param {string} recordId - ID of the record to delete\n * @param {Object} config - Configuration object with Airtable credentials\n * @param {string} config.AIRTABLE_BASE_ID - Airtable Base ID\n * @param {string} config.AIRTABLE_TABLE_NAME - Name of the Airtable table to delete the record from\n * @param {string} config.AIRTABLE_API_KEY - Airtable API Key\n * @returns {Promise<string|null>} - Promise that resolves to the deleted record ID or null if not found\n * @throws {Error} - Throws an error if unable to delete the record from Airtable\n */\nasync function deleteRecord(recordId, config) {\n  const url = `https://api.airtable.com/v0/${config.AIRTABLE_BASE_ID}/${config.AIRTABLE_TABLE_NAME}/${recordId}`;\n  console.log(\"url: \", url);\n  try {\n    const response = await axios.delete(url, {\n      headers: {\n        Authorization: `Bearer ${config.AIRTABLE_API_KEY}`,\n      },\n    });\n    return recordId;\n  } catch (error) {\n    if (error.response.status === 404) {\n      return null;\n    } else {\n      throw new Error(\"Unable to delete record from Airtable\");\n    }\n  }\n}\n\n/**\n * Creates an instance of the AirtableService.\n * @param {Object} options - An object that contains the configuration for the AirtableService.\n * @param {string} options.AIRTABLE_API_KEY - The API key for the Airtable account.\n * @param {string} options.AIRTABLE_BASE_ID - The ID of the Airtable base.\n * @param {string} options.AIRTABLE_TABLE_NAME - The name of the table in the Airtable base.\n * @returns {AirtableService} An instance of the AirtableService.\n */\nexport function AirtableService({\n  AIRTABLE_API_KEY,\n  AIRTABLE_BASE_ID,\n  AIRTABLE_TABLE_NAME,\n}) {\n  const config = {\n    AIRTABLE_API_KEY,\n    AIRTABLE_BASE_ID,\n    AIRTABLE_TABLE_NAME,\n  };\n  return {\n    airServiceLog: () => airServiceLog(),\n    getAllRecords: () => getAllRecords(config),\n    getRecordById: (recordId) => getRecordById(recordId, config),\n    createRecord: (data, validator) => createRecord(data, validator, config),\n    updateRecord: (recordId, data, validator) =>\n      updateRecord(recordId, data, validator, config),\n    deleteRecord: (recordId) => deleteRecord(recordId, config),\n  };\n}\n"],"names":["_catch","body","recover","result","e","then","validateData","data","validator","isValid","error","validatorOutput","validatorOutputKeys","Object","keys","length","includes","Error","_ref","config","AIRTABLE_API_KEY","AIRTABLE_BASE_ID","AIRTABLE_TABLE_NAME","airServiceLog","console","log","getAllRecords","url","Promise","resolve","axios","get","headers","Authorization","response","status","records","reject","getRecordById","recordId","createRecord","_validateData","post","Array","isArray","concat","updateRecord","_validateData2","patch","deleteRecord"],"mappings":"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"}